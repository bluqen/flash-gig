# FlashGig - Complete Documentation

## Table of Contents
1. [Overview](#overview)
2. [Architecture](#architecture)
3. [Setup & Installation](#setup--installation)
4. [Project Structure](#project-structure)
5. [Core Components](#core-components)
6. [Views](#views)
7. [API Client](#api-client)
8. [Server Endpoints](#server-endpoints)
9. [Theming System](#theming-system)
10. [Common Issues & Solutions](#common-issues--solutions)

---

## Overview

**FlashGig** is a collaboration platform designed to reduce friction between freelancers and clients. It's NOT a freelancing marketplace itself - instead, it's a separate tool that freelancers and clients use AFTER connecting on platforms like Fiverr, Upwork, etc.

### Key Features
- **Connection Management**: Send and accept collaboration requests
- **Project Workspace**: Create projects from accepted connections
- **Live Collaboration**: Real-time commenting system
- **Timestamp Comments**: Clients can comment at specific timestamps on media
- **Status Tracking**: Track project progress (in progress, review, approved, etc.)
- **Cross-Platform Exchange**: Users exchange their FlashGig usernames on external platforms

### Use Case Example
1. Client and Freelancer meet on Fiverr
2. They exchange FlashGig usernames
3. One sends a connection request on FlashGig
4. After acceptance, they create a project
5. They collaborate with live previews and timestamped comments
6. Client can pinpoint exactly what needs changing

---

## Architecture

### Technology Stack
- **Frontend**: Flet (Python UI framework)
- **Backend**: FastAPI (Python web framework)
- **Storage**: JSON file-based database
- **Authentication**: SHA-256 password hashing

### Design Pattern
The application follows a **routing architecture** with:
- **ContentRouter**: Manages view navigation
- **Views**: Full-page components (HomeView, ConnectionsView)
- **Components**: Reusable UI elements (TopBar, SideBar, Buttons)
- **API Client**: Abstraction layer for server communication

---

## Setup & Installation

### Prerequisites
```bash
# Install Python 3.8+
python --version

# Install dependencies
pip install flet fastapi uvicorn
```

### Running the Application

#### 1. Start the Backend Server
```bash
# Navigate to project root
cd flashgig

# Start FastAPI server
python -m uvicorn src.server:app --reload --port 8000
```

#### 2. Start the Frontend
```bash
# In a new terminal
python src/main.py
```

### Environment Variables
```bash
# Optional: Change server URL
export SERVER_BASE="http://127.0.0.1:8000"
```

---

## Project Structure

```
flashgig/
├── src/
│   ├── main.py                 # Application entry point
│   ├── server.py               # FastAPI backend server
│   ├── api_client.py           # API communication layer
│   │
│   ├── components/             # Reusable UI components
│   │   ├── TopBar.py          # Top navigation bar
│   │   ├── SideBar.py         # Left navigation sidebar
│   │   ├── LoginOverlay.py    # Login/signup dialogs
│   │   ├── AccountButton.py   # User account dropdown
│   │   ├── NewButton.py       # "New" action menu
│   │   ├── BaseButton.py      # Base button component
│   │   ├── GradientText.py    # Gradient text component
│   │   ├── ThemeModeButton.py # Dark/light mode toggle
│   │   ├── OverviewCards.py   # Project cards
│   │   ├── NewConnectionDialog.py      # New connection dialog
│   │   └── CreateProjectDialog.py      # New project dialog
│   │
│   └── views/                  # Full-page views
│       ├── HomeView.py        # Project overview page
│       ├── ConnectionsView.py # Connections management page
│       └── ProjectView.py     # Individual project workspace
│
├── storage/                    # JSON database files
│   ├── users.json
│   ├── requests.json
│   ├── projects.json
│   └── comments.json
│
└── assets/                     # Static assets
    ├── fonts/
    └── icon.ico
```

---

## Core Components

### 1. ContentRouter (main.py)

**Purpose**: Manages navigation between different views

**Key Methods**:
- `navigate(route_name)`: Switch to a different view
- `reload_current_view()`: Refresh current view (used after login)
- `get_container()`: Returns the container holding current view

**Route Map**:
```python
self.routes = {
    "home": HomeView,
    "connections": ConnectionsView,
}
```

**Usage Example**:
```python
router = ContentRouter(page)
router.navigate("connections")  # Switch to connections view
```

---

### 2. TopBar (components/TopBar.py)

**Purpose**: Top navigation bar with search, actions, and account menu

**Components**:
- **SideMenuButton**: Toggle sidebar collapse
- **SearchBar**: Search functionality (placeholder)
- **NewButton**: Popup menu for creating connections/projects
- **AccountButton**: User profile dropdown
- **ThemeModeButton**: Dark/light mode toggle

**Critical Fix**: All containers must have `clip_behavior=ft.ClipBehavior.NONE` to allow popup menus to overflow outside bounds.

---

### 3. SideBar (components/SideBar.py)

**Purpose**: Left navigation sidebar with collapsible menu

**Features**:
- Gradient "Flash Gig" title
- Navigation links (Home, Connections)
- Collapsible state (icons only)
- Active link highlighting

**Methods**:
- `toggle_collapse()`: Switch between expanded/collapsed
- `_handle_link_click(clicked_link)`: Handle navigation

**Navigation Flow**:
```
User clicks link → SideBarLink calls on_click_callback 
→ SideBar deactivates other links 
→ Calls router.navigate(route)
```

---

### 4. LoginOverlay (components/LoginOverlay.py)

**Purpose**: Authentication system with login/signup

**Features**:
- Blocks app until logged in
- Switch between login and signup
- Client-side validation
- Server-side authentication
- Theme toggle in overlay

**Validation Rules**:
- Username: min 3 characters
- Password: min 6 characters
- Signup: passwords must match

**Flow**:
```
App starts → LoginOverlay shows → User logs in 
→ page.session_username set → Views reload → Overlay hides
```

---

### 5. NewButton (components/NewButton.py)

**Purpose**: Popup menu for creating new items

**Menu Items**:
- **New Connection**: Opens NewConnectionDialog
- **New Project**: Opens CreateProjectDialog

**Dialog Flow**:
```
Click "New" → Select action → Dialog opens 
→ Fill form → Submit → Success callback 
→ View refreshes → SnackBar notification
```

---

### 6. NewConnectionDialog (components/NewConnectionDialog.py)

**Purpose**: Send connection request to another user

**Fields**:
- `username_field`: Recipient's FlashGig username
- `project_field`: Project name/description

**Validation**:
- Both fields required
- Cannot connect with yourself
- User must exist on server

**Backend Call**:
```python
server_post("/requests", {
    "from_username": current_user,
    "to_username": recipient,
    "project_name": project_name,
})
```

---

### 7. CreateProjectDialog (components/CreateProjectDialog.py)

**Purpose**: Create project from accepted connection

**Flow**:
1. Load accepted connections into dropdown
2. User selects connection
3. Enters project title and description
4. Creates project linked to that connection

**Requirements**:
- Connection must be in "accepted" status
- Title is required
- Description is optional

---

### 8. AccountButton (components/AccountButton.py)

**Purpose**: User profile dropdown menu

**Features**:
- Circular avatar image
- Smooth dropdown animation
- Profile, Settings, Logout options
- Click-outside-to-close backdrop

**Animation Sequence**:
```
Click avatar → Menu opacity 0 → Add to overlay 
→ Animate to opacity 1, scale 1, offset 0 
→ User interacts → Click outside 
→ Animate out → Remove from overlay
```

---

## Views

### 1. HomeView (views/HomeView.py)

**Purpose**: Dashboard showing user's projects

**Features**:
- Grid of project cards
- Empty state with icon
- Refresh button
- Click card to open project

**Data Loading**:
```python
# Get user's projects
projects = server_get(f"/projects?user={username}")

# Filter by user's accepted connections
# Display as OverviewCard components
```

**States**:
- **Loading**: Shows "Loading projects..."
- **Empty**: Icon + "No projects yet" message
- **Loaded**: Grid of OverviewCard components

---

### 2. ConnectionsView (views/ConnectionsView.py)

**Purpose**: Manage connection requests

**Features**:
- List of incoming and outgoing connections
- Accept/Reject buttons for incoming requests
- Status badges (Pending, Accepted)
- Direction indicators (← From, To →)

**Connection States**:
- **requested**: Pending, awaiting response
- **accepted**: Approved, can create projects

**Actions**:
- **Accept**: Changes status to "accepted"
- **Reject**: Currently just UI (no DELETE endpoint yet)

---

### 3. ProjectView (views/ProjectView.py)

**Purpose**: Individual project workspace

**Features**:
- Project details section
- Status dropdown (in progress, review, approved, etc.)
- Comments feed
- Add comments with optional timestamps
- Back to overview button

**Status Options**:
- in_progress
- review
- changes_requested
- approved
- completed

**Comment Features**:
- Username display
- Timestamp (optional, for media)
- Created date
- Text content

---

## API Client

### Purpose
Abstraction layer between frontend and backend. Handles all HTTP communication.

### Core Functions

#### `server_get(path, params)`
```python
# Example: Get user's connections
connections = server_get("/requests?user=john_doe")
```

#### `server_post(path, data)`
```python
# Example: Create new connection
result = server_post("/requests", {
    "from_username": "alice",
    "to_username": "bob",
    "project_name": "Website Redesign"
})
```

#### `server_patch(path, data)`
```python
# Example: Accept connection
server_patch("/requests/abc-123", {"status": "accepted"})
```

### Convenience Functions

#### `get_user_connections(username)`
Returns all connections for a user (incoming + outgoing)

#### `get_user_projects(username)`
Returns all projects user is part of

#### `get_project_comments(project_id)`
Returns all comments on a project

### Error Handling
```python
try:
    data = server_get("/some-endpoint")
except APIClientError as e:
    print(f"API Error: {e}")
    # Handle error (show message to user)
```

---

## Server Endpoints

### Authentication

#### `POST /register`
Create new user account
```json
Request: {"username": "alice", "password": "secret123"}
Response: {"id": "...", "username": "alice", "created_at": "..."}
```

#### `POST /login`
Authenticate user
```json
Request: {"username": "alice", "password": "secret123"}
Response: {"id": "...", "username": "alice", "created_at": "..."}
```

#### `GET /users/{username}`
Get user info (without password)

---

### Connection Requests

#### `POST /requests`
Send connection request
```json
Request: {
    "from_username": "alice",
    "to_username": "bob",
    "project_name": "Logo Design"
}
```

#### `GET /requests?user={username}`
Get all connections for user

#### `PATCH /requests/{req_id}`
Update request status
```json
Request: {"status": "accepted"}
```

---

### Projects

#### `POST /projects`
Create new project from accepted connection
```json
Request: {
    "request_id": "connection-id",
    "title": "E-commerce Website",
    "description": "Build modern online store"
}
```

#### `GET /projects?user={username}`
Get user's projects

#### `GET /projects/{project_id}`
Get specific project details

#### `PATCH /projects/{project_id}`
Update project
```json
Request: {"status": "review"}
```

---

### Comments

#### `POST /comments`
Add comment to project
```json
Request: {
    "project_id": "proj-123",
    "username": "alice",
    "text": "Please change the header color",
    "timestamp": 45  // Optional: video/audio timestamp
}
```

#### `GET /comments?project_id={id}`
Get all comments for project

---

## Theming System

### Semantic Colors
FlashGig uses Flet's semantic color system for automatic light/dark mode:

```python
# Instead of hardcoded colors:
bgcolor="#ffffff"  # ❌ Won't change with theme

# Use semantic colors:
bgcolor=ft.Colors.SURFACE  # ✅ Auto-updates
```

### Color Mapping

#### Light Theme
- **Primary**: #2196f3 (blue accent)
- **Surface**: #ffffff (backgrounds)
- **Surface Variant**: #f5f5f5 (cards)
- **Outline**: #e0e0e0 (borders)
- **On Surface**: #000000 (text)

#### Dark Theme
- **Primary**: #64b5f6 (lighter blue)
- **Surface**: #111519 (dark backgrounds)
- **Surface Variant**: #252525 (dark cards)
- **Outline**: #404040 (dark borders)
- **On Surface**: #ffffff (white text)

### Theme Toggle
```python
# ThemeModeButton automatically switches:
page.theme_mode = ft.ThemeMode.LIGHT  # or DARK

# Page automatically updates all semantic colors
page.update()
```

---

## Common Issues & Solutions

### 1. NewButton Popup Not Showing

**Problem**: Popup menu is clipped by parent containers

**Solution**: Set `clip_behavior=ft.ClipBehavior.NONE` on ALL parent containers:
```python
# TopBar container
self.clip_behavior = ft.ClipBehavior.NONE

# All Row containers in TopBar
ft.Row([...], clip_behavior=ft.ClipBehavior.NONE)
```

---

### 2. Views Not Loading Data

**Problem**: `did_mount()` called before page is attached

**Solution**: Check if page exists before updating:
```python
def _load_data(self):
    self.controls = [loading_widget]
    if self.page:  # Check first
        self.update()
    
    # Load data...
    
    self.controls = [data_widget]
    if self.page:  # Check again
        self.update()
```

---

### 3. Login Overlay Not Blocking

**Problem**: User can interact with app before logging in

**Solution**: LoginOverlay already handles this by:
- Setting `expand=True` (fills entire screen)
- Using `bgcolor` to block background
- Called at app start in `main()`

---

### 4. Theme Not Updating Components

**Problem**: Hardcoded colors don't change with theme

**Solution**: Replace ALL hardcoded colors with semantic colors:
```python
# Before
bgcolor="#ffffff"
color="#000000"

# After
bgcolor=ft.Colors.SURFACE
color=ft.Colors.ON_SURFACE
```

---

### 5. Router Not Navigating

**Problem**: Clicking sidebar links doesn't change view

**Solution**: Check callback chain:
```python
# 1. SideBar receives on_navigate callback
sidebar = SideBar(page, on_navigate=router.navigate)

# 2. SideBarLink has route attribute
SideBarLink(..., route="home")

# 3. Link click calls callback with route
self.on_navigate(clicked_link.route)
```

---

### 6. Server Connection Failed

**Problem**: "Cannot connect to server" errors

**Solutions**:
1. Check server is running: `ps aux | grep uvicorn`
2. Verify port: `http://127.0.0.1:8000/health`
3. Check firewall settings
4. Set `SERVER_BASE` environment variable if needed

---

### 7. Password Hashing Issues

**Problem**: Login fails even with correct password

**Solution**: Server uses SHA-256 with salt. Never store plain passwords. Always use:
```python
# Registration
hashed = get_password_hash(plain_password)

# Login
verify_password(plain_password, stored_hash)
```

---

## Development Workflow

### Adding a New View

1. **Create view file** in `views/`
```python
class MyNewView(ft.Container):
    def __init__(self, page: ft.Page):
        super().__init__()
        self.page = page
        self.expand = True
        # ... build UI
```

2. **Register in router** (main.py)
```python
self.routes = {
    "home": HomeView,
    "connections": ConnectionsView,
    "mynew": MyNewView,  # Add here
}
```

3. **Add sidebar link** (SideBar.py)
```python
self.links = [
    SideBarLink(page, "Home", ft.Icons.HOME, route="home"),
    SideBarLink(page, "My New View", ft.Icons.STAR, route="mynew"),
]
```

---

### Adding a New Endpoint

1. **Add server route** (server.py)
```python
@app.get("/my-endpoint")
def my_endpoint(param: str = Query(...)):
    # Logic here
    return {"result": "data"}
```

2. **Add API client function** (api_client.py)
```python
def get_my_data(param: str):
    try:
        return server_get(f"/my-endpoint?param={param}")
    except APIClientError:
        return None
```

3. **Use in view**
```python
from api_client import get_my_data

data = get_my_data("value")
```

---

## Best Practices

### 1. Always Use Semantic Colors
```python
# Good
bgcolor=ft.Colors.SURFACE
color=ft.Colors.ON_SURFACE

# Bad
bgcolor="#ffffff"
```

### 2. Check Page Before Update
```python
if self.page:
    self.update()
```

### 3. Handle API Errors
```python
try:
    data = server_get(...)
except APIClientError as e:
    # Show error to user
    self.error_text.value = str(e)
```

### 4. Use Callbacks for Actions
```python
def show_dialog(on_success=None):
    # ... dialog logic
    if on_success:
        on_success()  # Refresh parent view
```

### 5. Validate Input Client-Side
```python
if not username or not password:
    self.show_error("Fields required")
    return

# Then validate server-side too
```

---

## Future Enhancements

### Planned Features
- [ ] File upload for live previews
- [ ] Real-time notifications
- [ ] Video/audio timeline with comments
- [ ] Project templates
- [ ] Team collaboration (multiple users per project)
- [ ] Export project history
- [ ] Integration with external platforms (Fiverr API, etc.)
- [ ] Mobile app version

### Technical Improvements
- [ ] Database migration (SQLite/PostgreSQL)
- [ ] WebSocket for real-time updates
- [ ] JWT authentication tokens
- [ ] Profile pictures upload
- [ ] Search functionality implementation
- [ ] Pagination for large lists
- [ ] Unit tests
- [ ] Docker containerization

---

## Troubleshooting Guide

### Check Server Health
```bash
curl http://127.0.0.1:8000/health
# Should return: {"status": "ok"}
```

### View Server Logs
```bash
# Server prints requests and errors
# Look for lines starting with ✓ (success) or ✗ (error)
```

### Clear Storage (Reset Database)
```bash
rm storage/*.json
# Restart server - files will regenerate
```

### Debug Mode
```python
# Add to main.py
page.debug = True

# Add print statements
print(f"Debug: {variable}")
```

---

## Contributing

### Code Style
- Use semantic colors
- Add docstrings to functions
- Handle errors gracefully
- Follow existing naming conventions

### Testing Changes
1. Test login/logout flow
2. Test light/dark themes
3. Test all navigation routes
4. Test API error scenarios
5. Test on different screen sizes

---

## License & Credits

**FlashGig** - Freelancer-Client Collaboration Platform

Built with:
- [Flet](https://flet.dev) - Python UI framework
- [FastAPI](https://fastapi.tiangolo.com) - Modern Python web framework

---

## Quick Reference

### Keyboard Shortcuts
- None currently implemented (future feature)

### Default Credentials
- Create account via signup overlay

### File Locations
- User data: `storage/users.json`
- Connections: `storage/requests.json`
- Projects: `storage/projects.json`
- Comments: `storage/comments.json`

### Port Configuration
- Backend: 8000 (FastAPI)
- Frontend: Dynamic (Flet)

---

**Last Updated**: October 2025
**Version**: 0.1.2